# js_cli Component

**Type**: Application (Level 4)
**Tech Stack**: Rust, clap, rustyline
**Version**: 0.1.0

## Purpose
Command-line interface for the JavaScript runtime with REPL, file execution, and debugging capabilities. This is the main entry point.

## Dependencies
- `parser`: Parser, BytecodeGenerator
- `interpreter`: VM
- `builtins`: All built-ins
- `async_runtime`: EventLoop
- `jit_compiler`: BaselineJIT, OptimizingJIT

## Token Budget
- Optimal: 20,000 tokens
- Warning: 30,000 tokens
- Critical: 40,000 tokens

## Application Entry Point

```rust
use clap::Parser as ClapParser;
use rustyline::Editor;

#[derive(ClapParser)]
#[command(name = "corten-js")]
#[command(about = "JavaScript runtime written in Rust")]
struct Cli {
    /// JavaScript file to execute
    #[arg(short, long)]
    file: Option<String>,

    /// Run REPL
    #[arg(short, long)]
    repl: bool,

    /// Enable JIT compilation
    #[arg(long)]
    jit: bool,

    /// Print bytecode
    #[arg(long)]
    print_bytecode: bool,
}

fn main() -> Result<(), Box<dyn std::error::Error>> {
    let cli = Cli::parse();
    let mut runtime = Runtime::new(cli.jit);

    if let Some(file) = cli.file {
        runtime.execute_file(&file)?;
    } else if cli.repl {
        run_repl(&mut runtime)?;
    }

    Ok(())
}
```

## Key Features

### REPL (Read-Eval-Print Loop)
- Interactive JavaScript console
- Command history (rustyline)
- Multi-line input support
- Error display with stack traces

### File Execution
- Parse JavaScript files
- Execute with proper module resolution
- Exit codes per JavaScript result

### Debug Options
- `--print-bytecode`: Show generated bytecode
- `--print-ast`: Show AST
- `--profile`: Show profiling data
- `--no-jit`: Disable JIT compilation

### Console Integration
- Wire `console.log`, `console.error`, etc. to stdout/stderr
- Proper formatting of JavaScript values
- Error stack trace display

## Mandatory Requirements

### 1. Test-Driven Development
- Test CLI argument parsing
- Test file execution
- Test REPL commands
- 80%+ coverage

### 2. Minimal Code
This is an APPLICATION component - minimal logic:
- Bootstrap other components
- Parse CLI arguments
- Wire stdout/stderr
- Handle errors gracefully

### 3. File Structure
```
src/
  main.rs            # Entry point
  cli.rs             # Argument parsing
  runtime.rs         # Runtime wrapper
  repl.rs            # REPL implementation
tests/
  unit/
  integration/       # End-to-end tests
  contracts/
```

## Primary User Workflow (Smoke Test)

```bash
# Execute JavaScript file
./corten-js example.js

# Run REPL
./corten-js --repl

# Print bytecode
./corten-js --print-bytecode example.js

# Disable JIT
./corten-js --no-jit example.js
```

## Git Commit Format
```
[js_cli] <type>: <description>
```

## Definition of Done
- [ ] CLI argument parsing works
- [ ] TDD cycles in git history
- [ ] 80%+ coverage
- [ ] REPL functional
- [ ] File execution working
- [ ] Console output correct
- [ ] Error handling graceful
- [ ] Contract tests passing
